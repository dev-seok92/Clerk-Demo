# Next.jsì— Clerk ì—°ë™í•˜ê¸°

ì´ ë¬¸ì„œëŠ” Next.js ì• í”Œë¦¬ì¼€ì´ì…˜ì— Clerk ì¸ì¦ ì‹œìŠ¤í…œì„ ì—°ë™í•˜ëŠ” ê³¼ì •ì„ ë‹¨ê³„ë³„ë¡œ ì„¤ëª…í•©ë‹ˆë‹¤.

## ëª©ì°¨
1. [Clerk íŒ¨í‚¤ì§€ ì„¤ì¹˜](#1-clerk-íŒ¨í‚¤ì§€-ì„¤ì¹˜)
2. [í™˜ê²½ ë³€ìˆ˜ ì„¤ì •](#2-í™˜ê²½-ë³€ìˆ˜-ì„¤ì •)
3. [ClerkProvider ì„¤ì •](#3-clerkprovider-ì„¤ì •)
4. [Middleware ì„¤ì •](#4-middleware-ì„¤ì •)
5. [í˜ì´ì§€ì—ì„œ Clerk ì‚¬ìš©í•˜ê¸°](#5-í˜ì´ì§€ì—ì„œ-clerk-ì‚¬ìš©í•˜ê¸°)
6. [ì£¼ìš” ì»´í¬ë„ŒíŠ¸ ë° í›…](#6-ì£¼ìš”-ì»´í¬ë„ŒíŠ¸-ë°-í›…)

---

## 1. Clerk íŒ¨í‚¤ì§€ ì„¤ì¹˜

ë¨¼ì € Clerkì˜ Next.js íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.

```bash
npm install @clerk/nextjs
```

**package.json**ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆëŠ” ì„¤ì¹˜ëœ íŒ¨í‚¤ì§€:

```json
  {
    "dependencies": {
      "@clerk/nextjs": "^6.25.4",
      "next": "15.4.2",
      "react": "19.1.0",
      "react-dom": "19.1.0"
    }
  }
```

---

## 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— `.env.local` íŒŒì¼ì„ ìƒì„±í•˜ê³  Clerk Dashboardì—ì„œ ì–»ì€ í‚¤ë“¤ì„ ì„¤ì •í•©ë‹ˆë‹¤:

```env
  NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...
  CLERK_SECRET_KEY=sk_test_...
  
  # ì„ íƒì‚¬í•­: ë¡œê·¸ì¸/íšŒì›ê°€ì… í›„ ë¦¬ë‹¤ì´ë ‰íŠ¸ URL
  NEXT_PUBLIC_CLERK_SIGN_IN_URL=/sign-in
  NEXT_PUBLIC_CLERK_SIGN_UP_URL=/sign-up
  NEXT_PUBLIC_CLERK_AFTER_SIGN_IN_URL=/
  NEXT_PUBLIC_CLERK_AFTER_SIGN_UP_URL=/
```

---

## 3. ClerkProvider ì„¤ì •

**app/layout.tsx**ì—ì„œ `ClerkProvider`ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê°ìŒ‰ë‹ˆë‹¤:

```tsx
  import { type Metadata } from 'next'
  import {
    ClerkProvider,
    SignInButton,
    SignUpButton,
    SignedIn,
    SignedOut,
    UserButton,
  } from '@clerk/nextjs'
  import { Geist, Geist_Mono } from 'next/font/google'
  import './globals.css'

  const geistSans = Geist({
    variable: '--font-geist-sans',
    subsets: ['latin'],
  })

  const geistMono = Geist_Mono({
    variable: '--font-geist-mono',
    subsets: ['latin'],
  })

  export const metadata: Metadata = {
    title: 'Clerk Next.js Quickstart',
    description: 'Generated by create next app',
  }

  export default function RootLayout({
    children,
  }: Readonly<{
    children: React.ReactNode
  }>) {
    return (
      <ClerkProvider>
        <html lang="en">
          <body className={`${geistSans.variable} ${geistMono.variable} antialiased`}>
            <header className="flex justify-end items-center p-4 gap-4 h-16">
              <SignedOut>
                <SignInButton />
                <SignUpButton>
                  <button className="bg-[#6c47ff] text-white rounded-full font-medium text-sm sm:text-base h-10 sm:h-12 px-4 sm:px-5 cursor-pointer">
                    Sign Up
                  </button>
                </SignUpButton>
              </SignedOut>
              <SignedIn>
                <UserButton />
              </SignedIn>
            </header>
            {children}
          </body>
        </html>
      </ClerkProvider>
    )
  }
```

### ì£¼ìš” êµ¬ì„± ìš”ì†Œ:
- **ClerkProvider**: ì „ì²´ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê°ì‹¸ëŠ” ì»¨í…ìŠ¤íŠ¸ ì œê³µì
- **SignedIn/SignedOut**: ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¥¸ ì¡°ê±´ë¶€ ë Œë”ë§
- **SignInButton/SignUpButton**: ë¡œê·¸ì¸/íšŒì›ê°€ì… ë²„íŠ¼
- **UserButton**: ë¡œê·¸ì¸ëœ ì‚¬ìš©ìì˜ í”„ë¡œí•„ ë²„íŠ¼

---

## 4. Middleware ì„¤ì •

**middleware.ts** íŒŒì¼ì„ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— ìƒì„±í•©ë‹ˆë‹¤:

```typescript
  import { clerkMiddleware } from '@clerk/nextjs/server';

  export default clerkMiddleware();

  export const config = {
    matcher: [
      // Skip Next.js internals and all static files, unless found in search params
      '/((?!_next|[^?]*\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
      // Always run for API routes
      '/(api|trpc)(.*)',
    ],
  };
```

### Middlewareì˜ ì—­í• :
- ëª¨ë“  ìš”ì²­ì—ì„œ ì¸ì¦ ìƒíƒœë¥¼ í™•ì¸
- ë³´í˜¸ëœ ë¼ìš°íŠ¸ì— ëŒ€í•œ ì ‘ê·¼ ì œì–´
- ìë™ìœ¼ë¡œ ì¸ì¦ í† í° ê´€ë¦¬

---

## 5. í˜ì´ì§€ì—ì„œ Clerk ì‚¬ìš©í•˜ê¸°

**app/page.tsx**ì—ì„œ Clerk ì»´í¬ë„ŒíŠ¸ì™€ í›…ì„ ì‚¬ìš©í•œ ì˜ˆì‹œ:

```tsx
  "use client";

  import { SignedIn, SignedOut, useUser, SignInButton } from "@clerk/nextjs";

  export default function Home() {
    return (
      <div className="flex items-center justify-center min-h-screen bg-gray-50">
        <div className="max-w-md w-full mx-auto p-8 bg-white rounded-lg shadow-md text-center">
          {/* ë¡œê·¸ì¸ëœ ì‚¬ìš©ìì—ê²Œ í‘œì‹œí•  ë‚´ìš© */}
          <SignedIn>
            <WelcomeMessage />
          </SignedIn>

          {/* ë¡œê·¸ì¸ë˜ì§€ ì•Šì€ ì‚¬ìš©ìì—ê²Œ í‘œì‹œí•  ë‚´ìš© */}
          <SignedOut>
            <div className="space-y-6">
              <h1 className="text-2xl font-bold text-gray-900">
                ë¡œê·¸ì¸ì„ ì§„í–‰í•´ì£¼ì„¸ìš”
              </h1>
              <p className="text-gray-600">
                ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ê¸° ìœ„í•´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.
              </p>
              <div className="pt-4">
                <SignInButton mode="modal">
                  <button className="w-full bg-[#6c47ff] hover:bg-[#5639d9] text-white font-medium py-3 px-6 rounded-lg transition-colors">
                    ë¡œê·¸ì¸í•˜ê¸°
                  </button>
                </SignInButton>
              </div>
            </div>
          </SignedOut>
        </div>
      </div>
    );
  }

  function WelcomeMessage() {
    const { user } = useUser();
    
    return (
      <div className="space-y-6">
        <div className="text-6xl">ğŸ‘‹</div>
        <h1 className="text-2xl font-bold text-gray-900">
          í™˜ì˜í•©ë‹ˆë‹¤, {user?.firstName || user?.username || "ì‚¬ìš©ì"}ë‹˜!
        </h1>
        <p className="text-gray-600">
          ì„±ê³µì ìœ¼ë¡œ ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.
        </p>
        <div className="pt-4 text-sm text-gray-500">
          <p>ì´ë©”ì¼: {user?.emailAddresses[0]?.emailAddress}</p>
        </div>
      </div>
    );
  }
```

### ì£¼ìš” íŠ¹ì§•:
- **"use client"**: í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ì»´í¬ë„ŒíŠ¸ ëª…ì‹œ
- **ì¡°ê±´ë¶€ ë Œë”ë§**: ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¥¸ ë‹¤ë¥¸ UI í‘œì‹œ
- **ì‚¬ìš©ì ì •ë³´ ì ‘ê·¼**: `useUser` í›…ìœ¼ë¡œ ì‚¬ìš©ì ë°ì´í„° ì‚¬ìš©

---

## 6. ì£¼ìš” ì»´í¬ë„ŒíŠ¸ ë° í›…

### ì¡°ê±´ë¶€ ë Œë”ë§ ì»´í¬ë„ŒíŠ¸

```tsx
  import { SignedIn, SignedOut } from "@clerk/nextjs";

  // ë¡œê·¸ì¸ëœ ì‚¬ìš©ìì—ê²Œë§Œ í‘œì‹œ
  <SignedIn>
    <div>ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì „ìš© ì½˜í…ì¸ </div>
  </SignedIn>

  // ë¡œê·¸ì¸ë˜ì§€ ì•Šì€ ì‚¬ìš©ìì—ê²Œë§Œ í‘œì‹œ
  <SignedOut>
    <div>ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ì ì „ìš© ì½˜í…ì¸ </div>
  </SignedOut>
```

### ì¸ì¦ ê´€ë ¨ ë²„íŠ¼

```tsx
  import { SignInButton, SignUpButton, UserButton } from "@clerk/nextjs";

  // ë¡œê·¸ì¸ ë²„íŠ¼
  <SignInButton mode="modal">
    <button>ë¡œê·¸ì¸</button>
  </SignInButton>

  // íšŒì›ê°€ì… ë²„íŠ¼  
  <SignUpButton mode="modal">
    <button>íšŒì›ê°€ì…</button>
  </SignUpButton>

  // ì‚¬ìš©ì í”„ë¡œí•„ ë²„íŠ¼ (ë¡œê·¸ì¸ëœ ìƒíƒœì—ì„œë§Œ ì‚¬ìš©)
  <UserButton />
```

### ì‚¬ìš©ì ì •ë³´ í›…

```tsx
  import { useUser, useAuth } from "@clerk/nextjs";

  function UserProfile() {
    const { user, isLoaded } = useUser();
    const { signOut } = useAuth();

    if (!isLoaded) return <div>ë¡œë”© ì¤‘...</div>;

    return (
      <div>
        <p>ì‚¬ìš©ìëª…: {user?.username}</p>
        <p>ì´ë©”ì¼: {user?.emailAddresses[0]?.emailAddress}</p>
        <button onClick={() => signOut()}>ë¡œê·¸ì•„ì›ƒ</button>
      </div>
    );
  }
```

### ì„œë²„ ì‚¬ì´ë“œì—ì„œ ì‚¬ìš©ì ì •ë³´ ì ‘ê·¼

```tsx
  import { currentUser } from "@clerk/nextjs/server";

  export default async function ServerPage() {
    const user = await currentUser();

    return (
      <div>
        {user ? (
          <p>í™˜ì˜í•©ë‹ˆë‹¤, {user.firstName}ë‹˜!</p>
        ) : (
          <p>ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
        )}
      </div>
    );
  }
```

---

## ì¶”ê°€ ì„¤ì • ì˜µì…˜

### ì‚¬ìš©ì ì •ì˜ í˜ì´ì§€ ë¼ìš°íŠ¸

```typescript
  // middleware.tsì—ì„œ ë³´í˜¸ëœ ë¼ìš°íŠ¸ ì„¤ì •
  import { clerkMiddleware, createRouteMatcher } from '@clerk/nextjs/server'

  const isProtectedRoute = createRouteMatcher(['/dashboard(.*)', '/admin(.*)'])

  export default clerkMiddleware((auth, req) => {
    if (isProtectedRoute(req)) auth().protect()
  })
```

### í…Œë§ˆ ì»¤ìŠ¤í„°ë§ˆì´ì§•

```tsx
  // layout.tsxì—ì„œ ClerkProviderì— appearance prop ì¶”ê°€
  <ClerkProvider
    appearance={{
      baseTheme: dark, // ë˜ëŠ” neobrutalism
      variables: {
        colorPrimary: "#6c47ff",
        borderRadius: "8px"
      }
    }}
  >
    {/* ... */}
  </ClerkProvider>
```

---

## ê²°ë¡ 

ì´ì œ Next.js ì• í”Œë¦¬ì¼€ì´ì…˜ì— Clerk ì¸ì¦ ì‹œìŠ¤í…œì´ ì„±ê³µì ìœ¼ë¡œ ì—°ë™ë˜ì—ˆìŠµë‹ˆë‹¤. 
ì£¼ìš” ê¸°ëŠ¥ë“¤:

âœ… **ì™„ì „í•œ ì‚¬ìš©ì ì¸ì¦ ì‹œìŠ¤í…œ**  
âœ… **ì†Œì…œ ë¡œê·¸ì¸ ì§€ì›**  
âœ… **ì‚¬ìš©ì í”„ë¡œí•„ ê´€ë¦¬**  
âœ… **ì„¸ì…˜ ê´€ë¦¬**  
âœ… **ë³´ì•ˆ ê°•í™”ëœ ë¼ìš°íŠ¸ ë³´í˜¸**  

ë” ìì„¸í•œ ì •ë³´ëŠ” [Clerk ê³µì‹ ë¬¸ì„œ](https://clerk.com/docs)ë¥¼ ì°¸ê³ í•˜ì„¸ìš”. 